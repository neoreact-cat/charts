<!doctype html>
<html lang="ru-RU">
    <head>
        <link href="/charts/favicon.ico" rel="icon" type="image/x-icon" />
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type="text/javascript">
            google.charts.load('current', {
                'packages':['table', 'corechart', 'sankey'],
                'mapsApiKey': 'AIzaSyD-I3nnBs9JANZDMRpjjfPjzizh1VklxYI'
            });

            google.charts.setOnLoadCallback(function () {
                var jsonData = $.ajax({
                    url: "https://neoreact-cat.github.io/charts/pages/ru.russian-district-federal-budget-taxes-income-and-population/data.json",
                    dataType: "json",
                    async: true,
                    success: function(json){
                        var districtsTable = drawDistrictsTable(json)
                        var districtsIncomePie = drawDistrictsIncomePie(json)
                        var districtsPopulationPie = drawDistrictsPopulationPie(json)

                        google.visualization.events.addListener(districtsTable, 'select', function (e) {
                            districtsIncomePie.setSelection(districtsTable.getSelection());
                            districtsPopulationPie.setSelection(districtsTable.getSelection());
                        });

                        google.visualization.events.addListener(districtsIncomePie, 'select', function (e) {
                            districtsTable.setSelection(districtsIncomePie.getSelection());
                            districtsPopulationPie.setSelection(districtsIncomePie.getSelection());
                        });

                        google.visualization.events.addListener(districtsPopulationPie, 'select', function (e) {
                            districtsTable.setSelection(districtsPopulationPie.getSelection());
                            districtsIncomePie.setSelection(districtsPopulationPie.getSelection());
                        });
                    }})
            });

            function drawDistrictsTable(json) {
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Федеральный округ')
                data.addColumn('number', 'Доход в федеральный бюджет')
                data.addColumn('number', 'Численность населения')

                json.forEach(item => { data.addRow([item.District, item.Income, item.Population]) });
                data.sort({column: 1, desc: true}); 

                var table = new google.visualization.Table(document.getElementById('districts_table_div'));
                
                table.draw(data, {showRowNumber: true, width: '100%', height: '100%'})

                return table
            }

            function drawDistrictsIncomePie(json) {
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Федеральный округ')
                data.addColumn('number', 'Доход в федеральный бюджет')

                json.forEach(item => { data.addRow([item.District, item.Income]) });
                data.sort({column: 1, desc: true}); 

                var chart = new google.visualization.PieChart(document.getElementById('districts_income_chart_div'));
                chart.draw(data, {  title: 'Доход в федеральный бюджет', pieHole: 0, width: '600', height: '600', legend: 'none', });

                return chart
            }

            function drawDistrictsPopulationPie(json) {
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Федеральный округ')
                data.addColumn('number', 'Численность населения')
                data.addColumn('number', 'Доход в федеральный бюджет')

                json.forEach(item => { data.addRow([item.District, item.Population, item.Income]) });
                data.sort({column: 2, desc: true}); 

                var chart = new google.visualization.PieChart(document.getElementById('districts_population_chart_div'));
                chart.draw(data, { title: 'Численность населения', pieHole: 0, width: '600', height: '600', legend: 'none', view: {columns: [0, 1]} });

                return chart
            }

        </script>
    </head>
    <body>
        <table>
            <tr>
                <td colspan="2">
                    <div id="districts_table_div">
                </td>
            </tr>
            <tr>
                <td>
                    <div id="districts_income_chart_div">
                </td>
                <td>
                    <div id="districts_population_chart_div">
                </td>
            </tr>
        </table>
    </body>
</html>